@page
@model PHARMACY.Pages.Customer.Orders.IndexModel
@{
    ViewData["Title"] = "My Orders";
}

@if (TempData["OrderPlaced"] != null)
{
    <audio autoplay>
        <source src="/sounds/order.mp3" type="audio/mpeg">
    </audio>

    <div class="alert alert-success text-center mt-3">
        ✅ Order placed successfully
    </div>
}


<style>
    /* ===== Orders UI ===== */

    .order-card {
        border-radius: 20px;
        border: none;
        transition: all 0.3s ease;
        animation: fadeUp 0.6s ease;
    }

        .order-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 14px 35px rgba(0,0,0,0.12);
        }

    @@keyframes fadeUp {
        from

    {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }

    .status-badge {
        padding: 6px 14px;
        border-radius: 12px;
        font-size: 13px;
        font-weight: 600;
    }

    .status-pending {
        background: #fff3cd;
        color: #856404;
    }

    .status-completed {
        background: #d4edda;
        color: #155724;
    }

    .status-cancelled {
        background: #f8d7da;
        color: #721c24;
    }

    .action-btn {
        border-radius: 12px;
        transition: all 0.25s ease;
    }

        .action-btn:hover {
            transform: scale(1.05);
        }
</style>

<div class="container mt-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h3 class="fw-bold text-primary mb-0">🧾 My Orders</h3>
            <small class="text-muted">Track your orders & feedback</small>
        </div>

        <a asp-page="/Customer/Medicines/Index"
           class="btn btn-primary action-btn">
            ➕ New Order
        </a>
    </div>

    <!-- Success Message -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success text-center">
            @TempData["SuccessMessage"]
        </div>
    }

    <!-- Orders -->
    <div class="row g-4">
        @if (Model.Orders == null || Model.Orders.Count == 0)
        {
            <div class="col-12 text-center text-muted">
                <h5>No orders yet 🛒</h5>
                <p>Start by ordering your first medicine.</p>
            </div>
        }
        else
        {
            @foreach (var o in Model.Orders)
            {
                <div class="col-md-6 col-lg-4">
                    <div class="card order-card p-3 h-100">

                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <strong>Order #@o.OrderID</strong>

                            @if (o.Status == "Pending")
                            {
                                <span class="status-badge status-pending">Pending</span>
                            }
                            else if (o.Status == "Completed")
                            {
                                <span class="status-badge status-completed">Completed</span>
                            }
                            else
                            {
                                <span class="status-badge status-cancelled">Cancelled</span>
                            }
                        </div>

                        <hr class="my-2" />

                        <p class="mb-1">
                            <strong>💊 Medicine:</strong> @o.MedicineName
                        </p>

                        <p class="mb-1">
                            <strong>📦 Quantity:</strong> @o.Quantity
                        </p>

                        <p class="mb-1">
                            <strong>💰 Total:</strong> @o.Total.ToString("C")
                        </p>

                        <p class="mb-3 text-muted">
                            <strong>📅 Date:</strong> @o.OrderDate.ToShortDateString()
                        </p>

                        <div class="mt-auto">
                            @if (o.Status == "Pending")
                            {
                                <form method="post"
                                      asp-page-handler="Cancel"
                                      onsubmit="return confirm('Cancel this order?');">
                                    <input type="hidden" name="orderId" value="@o.OrderID" />
                                    <button class="btn btn-danger action-btn w-100">
                                        ❌ Cancel Order
                                    </button>
                                </form>
                            }
                            else if (o.Status == "Completed")
                            {
                                <a asp-page="/Customer/Orders/Feedback"
                                   asp-route-orderId="@o.OrderID"
                                   class="btn btn-success action-btn w-100">
                                    ⭐ Give Feedback
                                </a>
                            }
                            else
                            {
                                <button class="btn btn-secondary w-100" disabled>
                                    Cancelled
                                </button>
                            }
                        </div>

                    </div>
                </div>
            }
        }
    </div>

</div>
<!--  Celebration -->
@if (TempData["OrderPlaced"] != null)
{
    <div class="alert alert-success text-center mt-4">
        🎉 Your order has been placed successfully!
    </div>

    <audio autoplay>
        <source src="/sounds/order.mp3" type="audio/mpeg">
    </audio>
}

