@page
@model PHARMACY.Pages.Pharmacist.Medicines.IndexModel

<h2 class="section-title mb-4 text-center">💊 Pharmacy Medicines</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show text-center mb-4"
         role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<style>
    /* ================= GLASS SEARCH ================= */
    .search-glass {
        background: rgba(255,255,255,0.75);
        backdrop-filter: blur(14px);
        border-radius: 22px;
        box-shadow: 0 18px 45px rgba(0,0,0,0.08);
        transition: .35s ease;
    }

        .search-glass:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 70px rgba(0,0,0,.15);
        }

        .search-glass input,
        .search-glass select {
            border-radius: 14px;
            transition: .25s;
        }

            .search-glass input:focus,
            .search-glass select:focus {
                transform: scale(1.03);
                box-shadow: 0 0 0 4px rgba(13,110,253,.15);
            }

    /* ================= BUTTONS ================= */
    .btn-search {
        background: linear-gradient(135deg,#2563eb,#3b82f6);
        color: #fff;
        font-weight: 600;
        border-radius: 14px;
        transition: .3s;
    }

        .btn-search:hover {
            transform: scale(1.07);
            box-shadow: 0 15px 35px rgba(37,99,235,.45);
        }

    /* ================= ADD CARD ================= */
    .add-card {
        background: linear-gradient(135deg,#f8fbff,#eef4ff);
        border-radius: 24px;
        box-shadow: 0 22px 55px rgba(0,0,0,.08);
        transition: .35s ease;
    }

        .add-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 35px 80px rgba(0,0,0,.15);
        }

        .add-card input,
        .add-card select {
            border-radius: 14px;
        }

    .add-btn {
        background: linear-gradient(135deg,#22c55e,#16a34a);
        color: white;
        font-weight: 700;
        border-radius: 18px;
        transition: .3s;
    }

        .add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 20px 45px rgba(34,197,94,.55);
        }

    /* ================= TABLE ================= */
    .premium-table {
        border-collapse: separate;
        border-spacing: 0 10px;
    }

        .premium-table thead th {
            background: #0d6efd;
            color: #fff;
            padding: 14px;
            border: none;
        }

        .premium-table tbody tr {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 28px rgba(0,0,0,.06);
            animation: fadeRow .5s ease;
        }
    @@keyframes fadeRow {
        from

    {
        opacity: 0;
        transform: translateY(15px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }

    .premium-table tbody tr:hover {
        transform: translateY(-4px);
        box-shadow: 0 18px 45px rgba(0,0,0,.15);
    }

    /* Expiry */
    .expired {
        color: #dc3545;
        font-weight: 600;
    }

    .expiring-soon {
        color: #fd7e14;
        font-weight: 600;
    }

    .expiry-safe {
        color: #198754;
        font-weight: 600;
    }
</style>

<!-- 🔍 SEARCH + FILTER -->
<div class="card search-glass p-4 mb-4">
    <form method="post" class="row g-3 align-items-center">
        <div class="col-md-4">
            <input asp-for="SearchTerm" class="form-control"
                   placeholder="🔍 Search medicine..." />
        </div>

        <div class="col-md-4">
            <select asp-for="SelectedCategoryId" class="form-select">
                <option value="">All Categories</option>
                @foreach (var c in Model.Categories)
                {
                    <option value="@c.Id">@c.Name</option>
                }
            </select>
        </div>

        <div class="col-md-2 d-grid">
            <button type="submit" asp-page-handler="Search"
                    class="btn btn-search">
                🔍 Search
            </button>
        </div>

        <div class="col-md-2 d-grid">
            <button type="submit" asp-page-handler="Filter"
                    class="btn btn-primary">
                Apply
            </button>
        </div>
    </form>

    <form method="post" asp-page-handler="OutOfStock" class="mt-3">
        <button class="btn btn-danger w-100">
            ⚠ Out Of Stock
        </button>
    </form>
</div>

<!-- ➕ ADD MEDICINE -->
<div class="card add-card p-4 mb-4">
    <h5 class="fw-bold mb-3">➕ Add New Medicine</h5>

    <form method="post" asp-page-handler="Add">
        <div class="row g-3 align-items-end">

            <div class="col-md-3">
                <label class="form-label">Name</label>
                <input asp-for="NewMedicine.Name" class="form-control" required />
            </div>

            <div class="col-md-2">
                <label class="form-label">Stock</label>
                <input asp-for="NewMedicine.Stock_Quantity"
                       type="number" min="1"
                       class="form-control" required />
            </div>

            <div class="col-md-2">
                <label class="form-label">Price</label>
                <input asp-for="NewMedicine.Price"
                       type="number" step="0.01"
                       class="form-control" required />
            </div>

            <div class="col-md-3">
                <label class="form-label">Expiry</label>
                <input asp-for="NewMedicine.Expiry_Date"
                       type="date" class="form-control" required />
            </div>

            <div class="col-md-3">
                <label class="form-label">Category</label>
                <select asp-for="SelectedCategoryId"
                        class="form-select" required>
                    <option value="">-- Select Category --</option>
                    @foreach (var c in Model.Categories)
                    {
                        <option value="@c.Id">@c.Name</option>
                    }
                </select>
            </div>

            <div class="col-md-2 d-grid">
                <button class="btn add-btn">
                    🎉 Add Medicine
                </button>
            </div>
        </div>
    </form>
</div>

<!-- 📦 MEDICINES TABLE -->
<div class="card p-4">
    <h5 class="fw-bold mb-3">📦 Medicines List</h5>

    <div class="table-responsive">
        <table class="table premium-table text-center align-middle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Stock</th>
                    <th>Price</th>
                    <th>Expiry</th>
                    <th>Update</th>
                </tr>
            </thead>

            <tbody>
                @foreach (var m in Model.Medicines)
                {
                    var daysLeft = (m.Expiry_Date - DateTime.Now).Days;
                    <tr>
                        <td>@m.Medicine_ID</td>
                        <td class="fw-semibold">@m.Name</td>
                        <td>
                            @if (m.Stock_Quantity <= 0)
                            {
                                <span class="badge bg-danger">Out Of Stock</span>
                            }
                            else if (m.Stock_Quantity < 10)
                            {
                                <span class="badge bg-warning text-dark">
                                    Low (@m.Stock_Quantity)
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-success">
                                    @m.Stock_Quantity
                                </span>
                            }
                        </td>

                        <td>@m.Price EGP</td>
                        <td>
                            @if (daysLeft < 0)
                            {
                                <span class="expired">❌ Expired</span>
                            }
                            else if (daysLeft <= 30)
                            {
                                <span class="expiring-soon">⏳ @daysLeft days</span>
                            }
                            else
                            {
                                <span class="expiry-safe">✔ Safe</span>
                            }
                        </td>
                        <td>
                            <form method="post" asp-page-handler="Update"
                                  class="d-flex gap-2">
                                <input type="hidden"
                                       name="UpdateMedicineId"
                                       value="@m.Medicine_ID" />
                                <input name="NewStock"
                                       type="number"
                                       class="form-control form-control-sm"
                                       placeholder="Stock" />
                                <input name="NewExpiryDate"
                                       type="date"
                                       class="form-control form-control-sm" />
                                <button class="btn btn-warning btn-sm">
                                    Update
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>


